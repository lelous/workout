<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Workout Journal Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --bg-primary: #f2f2f7; --bg-secondary: #ffffff; --bg-accent: #f8f9fa;
            --text-primary: #1c1c1e; --text-secondary: #8e8e93; --text-tertiary: #c7c7cc;
            --border-color: #e5e5ea;
            --primary-grad: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-grad: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --primary: #667eea; --danger: #ff3b30;
            --shadow: 0 4px 12px rgba(0,0,0,0.06);
            --font-main: 'Exo 2', -apple-system, sans-serif;
        }
        [data-theme="dark"] {
            --bg-primary: #000000; --bg-secondary: #1c1c1e; --bg-accent: #2c2c2e;
            --text-primary: #ffffff; --text-secondary: #aeaeb2; --text-tertiary: #636366;
            --border-color: #38383a; --shadow: 0 4px 12px rgba(0,0,0,0.4);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: var(--font-main);
            background: var(--bg-primary); color: var(--text-primary);
            padding-bottom: calc(90px + env(safe-area-inset-bottom));
            transition: background 0.3s ease;
        }
        
        textarea, input, select {
            font-family: var(--font-main);
            font-size: 16px !important; padding: 12px; border-radius: 12px;
            border: 1px solid var(--border-color); background: var(--bg-secondary);
            color: var(--text-primary); width: 100%; -webkit-appearance: none;
        }
        
        .header {
            background: var(--primary-grad); color: white;
            padding: calc(45px + env(safe-area-inset-top)) 20px 20px;
            text-align: center; position: sticky; top: 0; z-index: 100;
            border-bottom-left-radius: 24px; border-bottom-right-radius: 24px;
            box-shadow: var(--shadow);
        }
        .header-actions { position: absolute; right: 20px; bottom: 20px; display: flex; gap: 12px; }
        .header-left { position: absolute; left: 20px; bottom: 20px; display: flex; gap: 12px; }
        
        .icon-btn {
            background: rgba(255,255,255,0.15); border: none; color: white; padding: 8px;
            border-radius: 50%; width: 36px; height: 36px; cursor: pointer; backdrop-filter: blur(10px);
            display: flex; align-items: center; justify-content: center;
        }
        .back-btn {
            background: rgba(255,255,255,0.15); border: none; color: white; padding: 8px 12px 8px 8px;
            border-radius: 12px; font-weight: 600; font-family: var(--font-main);
            display: flex; align-items: center; gap: 4px; cursor: pointer; font-size: 14px;
        }
        
        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .card { background: var(--bg-secondary); border-radius: 20px; padding: 20px; margin-bottom: 16px; box-shadow: var(--shadow); }
        .card h3 { color: var(--primary); margin-bottom: 10px; font-size: 18px; display: flex; align-items: center; justify-content: space-between; font-weight: 700; }
        
        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 14px;
            font-size: 16px; font-weight: 700; color: white; margin-bottom: 10px;
            font-family: var(--font-main);
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:active { transform: scale(0.98); opacity: 0.8; }
        .btn-primary { background: var(--primary-grad); }
        .btn-success { background: var(--success-grad); }
        .btn-secondary { background: var(--bg-accent); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-danger { background: rgba(255, 59, 48, 0.1); color: var(--danger); width: auto; padding: 8px 12px; font-size: 13px; }
        
        .action-btn-minimal {
            background: transparent; border: none; color: var(--text-secondary);
            padding: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .action-btn-minimal:active { color: var(--primary); transform: scale(0.95); }
        
        .set-row { display: flex; gap: 8px; align-items: center; margin-bottom: 12px; }
        .set-label { width: 30px; font-weight: 800; font-size: 18px; color: var(--text-tertiary); text-align: center; font-feature-settings: "tnum"; }
        .set-input { width: 75px; text-align: center; font-weight: 700; flex-shrink: 0; }
        
        .autofill-btn {
            background: transparent; color: var(--primary); border: none;
            width: 30px; height: 30px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; opacity: 0.7;
        }
        .autofill-btn:active { opacity: 1; transform: scale(1.2); }
        
        .add-set-btn {
            width: 100%; border: 1px dashed var(--border-color); background: transparent;
            color: var(--text-secondary); padding: 10px; border-radius: 12px;
            font-weight: 600; cursor: pointer; font-size: 14px;
        }
        .add-set-btn:active { background: var(--bg-accent); }

        .timer-display {
            position: fixed; bottom: calc(110px + env(safe-area-inset-bottom)); right: 20px;
            background: var(--primary-grad); color: white; width: 70px; height: 70px;
            border-radius: 50%; display: flex; flexDirection: column; align-items: center; justify-content: center;
            font-weight: 800; font-size: 18px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); z-index: 99;
        }
        .timer-controls { display:flex; gap:15px; margin-top:2px; }
        .timer-mod { font-size: 10px; cursor: pointer; opacity: 0.8; }

        .session-timer-container {
            background: rgba(0,0,0,0.05); padding: 6px 12px; border-radius: 12px;
            display: flex; align-items: center; gap: 8px;
        }
        .session-timer {
            font-size: 14px; font-weight: 700; font-feature-settings: "tnum"; color: var(--primary);
        }
        
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(var(--bg-secondary), 0.9); backdrop-filter: blur(20px); display: flex; justify-content: space-around; padding: 12px 0 calc(12px + env(safe-area-inset-bottom)); border-top: 1px solid var(--border-color); z-index: 1000; }
        .nav-btn { background: transparent; border: none; padding: 4px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; flex: 1; color: var(--text-secondary); }
        .nav-btn.active { color: var(--primary); }
        .nav-label { font-size: 10px; font-weight: 600; font-family: var(--font-main); }
        
        svg { stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .day-card { background: var(--bg-secondary); padding: 16px; border-radius: 16px; margin-bottom: 12px; border-left: 5px solid var(--primary); box-shadow: var(--shadow); cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--bg-secondary); padding: 15px; border-radius: 16px; text-align: center; box-shadow: var(--shadow); }
        .stat-val { font-size: 24px; font-weight: 800; color: var(--primary); }
        .stat-lbl { font-size: 12px; color: var(--text-secondary); margin-top: 4px; }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color); }
        .history-exercise { border-bottom: 1px solid var(--border-color); padding: 8px 0; font-size: 14px; }
        
        .reorder-controls { display: flex; gap: 4px; }
        
        /* Visual Plates */
        .barbell-container { display: flex; align-items: center; justify-content: center; margin-top: 15px; overflow-x: auto; padding: 10px 0; }
        .bar-end { width: 15px; height: 10px; background: #999; border-radius: 2px; }
        .bar-shaft { width: 40px; height: 10px; background: #999; }
        .plate { height: 60px; width: 10px; margin: 0 1px; border-radius: 2px; border: 1px solid rgba(0,0,0,0.1); }
        .plate-45 { background: #0047AB; height: 70px; } 
        .plate-35 { background: #FFD700; height: 60px; } 
        .plate-25 { background: #008000; height: 50px; } 
        .plate-10 { background: #E0E0E0; height: 40px; } 
        .plate-5 { background: #333; height: 35px; } 
        .plate-2_5 { background: #333; height: 30px; }

        .chart-svg { width: 100%; height: 180px; font-size: 10px; overflow: visible; }
        .chart-grid { stroke: var(--border-color); stroke-width: 1; stroke-dasharray: 4; }
        .chart-line { fill: none; stroke: var(--primary); stroke-width: 3; }
        .chart-label { fill: var(--text-secondary); text-anchor: end; dominant-baseline: middle; }
        .chart-axis { fill: var(--text-secondary); text-anchor: middle; font-size: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icons = {
            Home: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>,
            Dumbbell: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6.5 6.5h11"></path><path d="M6.5 17.5h11"></path><path d="M6 20v-2a6 6 0 1 1 12 0v2"></path><path d="M6 4v2a6 6 0 1 0 12 0V4"></path></svg>,
            Chart: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>,
            History: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            Back: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M19 12H5"></path><path d="M12 19l-7-7 7-7"></path></svg>,
            Moon: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>,
            Sun: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line></svg>,
            Export: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>,
            Trash: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Edit: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
            ChevronRight: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="9 18 15 12 9 6"></polyline></svg>,
            Magic: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="M4.93 4.93l1.41 1.41"></path><path d="M17.66 17.66l1.41 1.41"></path><path d="M4.93 19.07l1.41-1.41"></path><path d="M17.66 6.34l1.41-1.41"></path></svg>,
            User: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>,
            Up: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="18 15 12 9 6 15"></polyline></svg>,
            Down: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="6 9 12 15 18 9"></polyline></svg>,
            Warmup: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3.3.9 1.7 2.2 2.9 2.9 3.3z"></path></svg>,
            Upload: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>,
            Plus: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Close: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };

        const DEFAULT_WORKOUTS = {
            monday: { name: "Upper Push", focus: "Chest, Shoulders, Triceps", exercises: [ { name: "Flat Barbell Bench Press", sets: 4, reps: "6-8", rest: 240, description: "Lie on flat bench, feet flat on floor. Lower bar to mid-chest, press up." }, { name: "Incline Dumbbell Press", sets: 3, reps: "8-10", rest: 180, description: "Set bench to 30-45¬∞. Press dumbbells up from chest level." }, { name: "Standing Overhead Press", sets: 4, reps: "6-8", rest: 180, description: "Stand with barbell at shoulders. Press overhead, lock out arms." }, { name: "Cable Flyes", sets: 3, reps: "12-15", rest: 90, description: "Set cables at chest height. Bring handles together in front of chest." }, { name: "Lateral Raises", sets: 3, reps: "12-15", rest: 60, description: "Raise dumbbells out to sides until parallel to floor." }, { name: "Dips", sets: 3, reps: "8-12", rest: 120, description: "Lean forward slightly for chest emphasis. Lower until upper arms parallel." }, { name: "Tricep Pushdowns", sets: 3, reps: "12-15", rest: 60, description: "Keep elbows pinned to sides. Push down until arms fully extended." }, { name: "Cable Woodchops", sets: 3, reps: "12/side", rest: 45, description: "Stand sideways to cable. Pull from high to low across body." }, { name: "Hanging Leg Raises", sets: 3, reps: "10-15", rest: 60, description: "Hang from bar. Raise legs to 90¬∞. Lower abs pull legs up." } ] },
            tuesday: { name: "Lower", focus: "Quads, Hamstrings, Glutes", exercises: [ { name: "Squats", sets: 4, reps: "6-8", rest: 240, description: "Feet shoulder-width. Sit back and down. Knees track over toes." }, { name: "Romanian Deadlifts", sets: 4, reps: "8-10", rest: 180, description: "Slight knee bend. Hinge at hips. Push hips back." }, { name: "Bulgarian Split Squats", sets: 3, reps: "10-12/leg", rest: 120, description: "Rear foot elevated. Lower front knee to 90¬∞." }, { name: "Leg Press", sets: 3, reps: "12-15", rest: 120, description: "Lower until knees at 90¬∞. Push through heels." }, { name: "Leg Curls", sets: 3, reps: "12-15", rest: 90, description: "Curl heels toward glutes. Squeeze hamstrings." }, { name: "Walking Lunges", sets: 3, reps: "12/leg", rest: 90, description: "Step forward, lower back knee." }, { name: "Calf Raises", sets: 4, reps: "15-20", rest: 60, description: "Rise up on balls of feet. Hold squeeze at top." }, { name: "Med Ball Slams", sets: 3, reps: "10/side", rest: 45, description: "Rotate and slam ball to outside of foot." }, { name: "Pallof Press", sets: 3, reps: "12/side", rest: 60, description: "Stand sideways to cable. Press straight out." } ] },
            thursday: { name: "Upper Pull", focus: "Back, Rear Delts", exercises: [ { name: "Pull-Ups", sets: 4, reps: "6-10", rest: 180, description: "Pull chest to bar. Full extension at bottom." }, { name: "T-Bar Rows", sets: 4, reps: "8-10", rest: 180, description: "Hinge at hips. Pull to lower chest. Squeeze shoulder blades." }, { name: "Barbell/DB Rows", sets: 4, reps: "8-12", rest: 180, description: "Pull to hip/lower chest. Retract shoulder blades." }, { name: "Cable Rows", sets: 3, reps: "10-12", rest: 120, description: "Sit upright. Pull handle to lower chest." }, { name: "Face Pulls", sets: 3, reps: "15-20", rest: 90, description: "Pull to face level. External rotation at end." }, { name: "Chest-Supported Rows", sets: 3, reps: "12-15", rest: 90, description: "Set bench to 30-45¬∞. Lie chest-down. Pull handles to lower chest." }, { name: "Cable Oblique Twists", sets: 3, reps: "12/side", rest: 45, description: "Stand sideways. Pull across body." }, { name: "RKC Plank", sets: 3, reps: "30-45 sec", rest: 60, description: "Maximum tension - squeeze glutes, quads." } ] },
            friday: { name: "Lower", focus: "Quads, Hamstrings, Glutes", exercises: [ { name: "Front/Goblet Squat", sets: 4, reps: "8-10", rest: 180, description: "Torso upright. Elbows up." }, { name: "Leg Press", sets: 4, reps: "10-12", rest: 120, description: "Feet shoulder-width, mid-platform. Lower to 90¬∞." }, { name: "Hack Squat", sets: 3, reps: "12-15", rest: 90, description: "Lower controlled. Drive through heels. Quad focus." }, { name: "Stiff-Leg Deadlifts", sets: 3, reps: "10-12", rest: 120, description: "Slight knee bend. Hinge at hips. Feel stretch in hamstrings." }, { name: "Leg Curls", sets: 3, reps: "12-15", rest: 90, description: "Lying or seated. Curl heels to glutes. Slow negative." }, { name: "Reverse Lunges", sets: 3, reps: "10/leg", rest: 90, description: "Hold goblet dumbbell. Step back. Lower back knee down." }, { name: "Seated Calf Raises", sets: 4, reps: "15-20", rest: 60, description: "Knees bent targets soleus. Hold top squeeze." }, { name: "Copenhagen Plank", sets: 3, reps: "20-30 sec/side", rest: 60, description: "Side plank. Top foot on bench." }, { name: "Mountain Climbers", sets: 3, reps: "20 total", rest: 45, description: "Plank position. Drive knees to chest alternating." } ] }
        };

        function App() {
            const [view, setView] = useState('home');
            const [selectedDay, setSelectedDay] = useState(null);
            const [workoutLog, setWorkoutLog] = useState({});
            const [customWorkouts, setCustomWorkouts] = useState(DEFAULT_WORKOUTS);
            const [measurements, setMeasurements] = useState([]);
            const [personalRecords, setPersonalRecords] = useState({});
            const [darkMode, setDarkMode] = useState(false);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const load = (k) => { try { return JSON.parse(localStorage.getItem(k)); } catch(e) { return null; }};
                const savedCustom = load('customWorkouts');
                setWorkoutLog(load('workouts') || {});
                setCustomWorkouts((savedCustom && Object.keys(savedCustom).length > 0) ? savedCustom : DEFAULT_WORKOUTS);
                setMeasurements(load('measurements') || []);
                setPersonalRecords(load('personal-records') || {});
                if (localStorage.getItem('dark-mode') === 'true') { setDarkMode(true); document.documentElement.setAttribute('data-theme', 'dark'); }
                setLoading(false);
            }, []);

            useEffect(() => {
                if (!loading) {
                    localStorage.setItem('workouts', JSON.stringify(workoutLog));
                    localStorage.setItem('customWorkouts', JSON.stringify(customWorkouts));
                    localStorage.setItem('measurements', JSON.stringify(measurements));
                    localStorage.setItem('personal-records', JSON.stringify(personalRecords));
                    localStorage.setItem('dark-mode', darkMode);
                }
            }, [workoutLog, customWorkouts, measurements, personalRecords, darkMode, loading]);

            const toggleDarkMode = () => { setDarkMode(!darkMode); document.documentElement.setAttribute('data-theme', !darkMode ? 'dark' : 'light'); };
            const deleteWorkout = (date) => { if (confirm('Delete?')) { const n = { ...workoutLog }; delete n[date]; setWorkoutLog(n); } };

            if (loading) return <div className="container"><h2>Loading...</h2></div>;

            return (
                <div>
                    <Header view={view} setView={setView} setSelectedDay={setSelectedDay} darkMode={darkMode} toggleDarkMode={toggleDarkMode} />
                    <div className="container">
                        {view === 'home' && <Home setView={setView} workoutLog={workoutLog} customWorkouts={customWorkouts} />}
                        {view === 'workout' && <Workout selectedDay={selectedDay} setSelectedDay={setSelectedDay} customWorkouts={customWorkouts} workoutLog={workoutLog} setWorkoutLog={setWorkoutLog} personalRecords={personalRecords} setPersonalRecords={setPersonalRecords} />}
                        {view === 'stats' && <Stats workoutLog={workoutLog} personalRecords={personalRecords} />}
                        {view === 'manage' && <Manage customWorkouts={customWorkouts} setCustomWorkouts={setCustomWorkouts} measurements={measurements} setMeasurements={setMeasurements} />}
                        {view === 'history' && <History workoutLog={workoutLog} customWorkouts={customWorkouts} deleteWorkout={deleteWorkout} />}
                    </div>
                    <Nav view={view} setView={setView} />
                </div>
            );
        }

        function Header({ view, setView, setSelectedDay, darkMode, toggleDarkMode }) {
            return (
                <div className="header">
                    {view === 'home' ? (
                        <div className="header-left"><button className="icon-btn" onClick={() => setView('manage')}><Icons.User /></button></div>
                    ) : (
                        <button className="back-btn" onClick={() => {setView('home'); setSelectedDay(null)}}><Icons.Back /> Back</button>
                    )}
                    <h1>{view === 'home' ? 'Workout Pro' : view.toUpperCase()}</h1>
                    <div className="header-actions">
                        <button className="icon-btn" onClick={toggleDarkMode}>{darkMode ? <Icons.Sun /> : <Icons.Moon />}</button>
                    </div>
                </div>
            );
        }

        function Nav({ view, setView }) {
            const tabs = [ {id:'home',icon:<Icons.Home/>,label:'Home'}, {id:'workout',icon:<Icons.Dumbbell/>,label:'Train'}, {id:'stats',icon:<Icons.Chart/>,label:'Stats'}, {id:'history',icon:<Icons.History/>,label:'History'} ];
            return (
                <div className="nav">
                    {tabs.map(t => <button key={t.id} className={`nav-btn ${view === t.id ? 'active' : ''}`} onClick={() => setView(t.id)}>{t.icon}<span className="nav-label">{t.label}</span></button>)}
                </div>
            );
        }

        function Home({ setView, workoutLog, customWorkouts }) {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() + 1); // Monday
            const endOfWeek = new Date(today);
            endOfWeek.setDate(today.getDate() - today.getDay() + 7); // Sunday
            
            const weeklyCount = Object.keys(workoutLog).filter(date => {
                const d = new Date(date);
                return d >= startOfWeek && d <= endOfWeek;
            }).length;

            return (
                <div>
                    <div className="card" style={{background: 'var(--primary-grad)', color: 'white'}}>
                        <h2 style={{margin:0, color:'white', opacity:0.9}}>Weekly Goal</h2>
                        <h1 style={{fontSize:'48px', margin:'5px 0'}}>{weeklyCount}/5</h1>
                        <p style={{opacity:0.8, fontSize:'14px'}}>Workouts this week</p>
                    </div>
                    <button className="btn btn-primary" onClick={() => setView('workout')}>Start New Session</button>
                    <button className="btn btn-secondary" onClick={() => setView('stats')}>Stats & PRs</button>
                    
                    <div className="card"><h3>Schedule</h3>
                        {Object.entries(customWorkouts).map(([k,v]) => <div key={k} style={{padding:'8px 0', borderBottom:'1px solid #eee', textTransform:'capitalize'}}><strong>{k}</strong>: {v.name}</div>)}
                    </div>
                    <div className="card"><h3>Daily Targets</h3><p style={{fontSize:'14px', lineHeight:'1.6', color:'var(--text-secondary)'}}>Protein: 220g | Cals: 2500<br/>Carbs: 220g | Fats: 80g</p></div>
                </div>
            );
        }

        function Manage({ customWorkouts, setCustomWorkouts, measurements, setMeasurements }) {
            const [viewDay, setViewDay] = useState(null);
            const [newDay, setNewDay] = useState('');
            const [weightForm, setWeightForm] = useState('');
            const fileInput = useRef(null);

            const deleteDay = (key) => { if(confirm(`Delete ${key}?`)) { const n = {...customWorkouts}; delete n[key]; setCustomWorkouts(n); } };
            const addDay = () => { if(newDay) { setCustomWorkouts({...customWorkouts, [newDay.toLowerCase()]: { name: newDay, exercises: [] }}); setNewDay(''); } };
            const moveExercise = (day, idx, dir) => {
                const n = {...customWorkouts}; const exs = n[day].exercises;
                if (dir === -1 && idx > 0) { [exs[idx], exs[idx-1]] = [exs[idx-1], exs[idx]]; }
                if (dir === 1 && idx < exs.length - 1) { [exs[idx], exs[idx+1]] = [exs[idx+1], exs[idx]]; }
                setCustomWorkouts(n);
            };
            const deleteEx = (day, idx) => { if(confirm('Remove?')) { const n = {...customWorkouts}; n[day].exercises.splice(idx, 1); setCustomWorkouts(n); } };
            const addEx = (day) => { const name = prompt("Name:"); if(name) { const n = {...customWorkouts}; n[day].exercises.push({name, sets:3, reps:"10-12"}); setCustomWorkouts(n); } };
            
            const handleImport = (e) => {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => { try { const data = JSON.parse(e.target.result); Object.keys(data).forEach(k => localStorage.setItem(k, JSON.stringify(data[k]))); window.location.reload(); } catch(err) { alert("Invalid"); } };
                reader.readAsText(file);
            };

            const resetHistory = () => { if(confirm("Clear weight history?")) setMeasurements([]); };

            const dataPoints = measurements.slice(-10);
            const maxW = Math.max(...dataPoints.map(d => parseFloat(d.weight)), 0) + 5;
            const minW = Math.min(...dataPoints.map(d => parseFloat(d.weight)), 200) - 5;
            
            const points = dataPoints.map((m, i, arr) => {
                const y = 100 - ((m.weight - minW) / (maxW - minW) * 100); 
                return `${i * (300 / (arr.length > 1 ? arr.length - 1 : 1))},${y}`;
            }).join(' ');

            if (viewDay) return (
                <div>
                    <div style={{display:'flex', gap:'10px', marginBottom:'20px'}}><button className="icon-btn" style={{background:'gray'}} onClick={() => setViewDay(null)}><Icons.Back/></button><h2>{viewDay}</h2></div>
                    <div style={{marginBottom:'20px'}}>
                        <input value={customWorkouts[viewDay].name} onChange={e => { const n = {...customWorkouts}; n[viewDay].name = e.target.value; setCustomWorkouts(n); }} placeholder="Routine Name" />
                    </div>
                    {customWorkouts[viewDay].exercises.map((ex, i) => (
                        <div key={i} className="card" style={{display:'flex', justifyContent:'space-between'}}>
                            <span>{ex.name}</span>
                            <div style={{display:'flex', gap:'5px'}}>
                                <button className="autofill-btn" onClick={() => moveExercise(viewDay, i, -1)}><Icons.Up/></button>
                                <button className="autofill-btn" onClick={() => moveExercise(viewDay, i, 1)}><Icons.Down/></button>
                                <button className="action-btn-minimal" style={{color:'var(--danger)'}} onClick={() => deleteEx(viewDay, i)}><Icons.Trash/></button>
                            </div>
                        </div>
                    ))}
                    <button className="btn btn-primary" onClick={() => addEx(viewDay)}>+ Add Exercise</button>
                </div>
            );

            return (
                <div>
                    <div className="card">
                        <div style={{display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                            <h3>Weight Trend</h3>
                            <button className="action-btn-minimal" style={{color:'var(--danger)', fontSize:'12px'}} onClick={resetHistory}><Icons.Trash/></button>
                        </div>
                        <div style={{display:'flex', alignItems:'center'}}>
                            <div style={{width:'30px', height:'150px', display:'flex', flexDirection:'column', justifyContent:'space-between', fontSize:'10px', color:'var(--text-secondary)', textAlign:'right', paddingRight:'5px'}}>
                                <span>{Math.round(maxW)}</span><span>{Math.round(minW)}</span>
                            </div>
                            <div className="chart-wrapper" style={{width:'100%', height:'150px'}}>
                                <svg className="chart-svg" viewBox="0 0 300 100" preserveAspectRatio="none">
                                    <line x1="0" y1="25" x2="300" y2="25" className="chart-grid" />
                                    <line x1="0" y1="50" x2="300" y2="50" className="chart-grid" />
                                    <line x1="0" y1="75" x2="300" y2="75" className="chart-grid" />
                                    {measurements.length > 1 && <polyline points={points} className="chart-line" style={{fill:'none', stroke:'var(--primary)', strokeWidth:3}} />}
                                </svg>
                            </div>
                        </div>
                        <div style={{display:'flex', gap:'10px', marginTop:'10px'}}>
                            <input type="number" inputMode="decimal" placeholder="Lbs" value={weightForm} onChange={e => setWeightForm(e.target.value)} />
                            <button className="btn btn-primary" style={{width:'auto', margin:0}} onClick={() => { if(weightForm) setMeasurements([...measurements, {date:new Date().toISOString(), weight:weightForm}]); setWeightForm(''); }}>Log</button>
                        </div>
                    </div>

                    <div className="card"><h3>Schedule Editor</h3>{Object.keys(customWorkouts).map(d => (
                        <div key={d} style={{display:'flex', justifyContent:'space-between', padding:'10px 0', borderBottom:'1px solid #eee'}}>
                            <span style={{fontWeight:'bold', textTransform:'capitalize'}} onClick={() => setViewDay(d)}>{d}</span>
                            <div style={{display:'flex', gap:'10px'}}><button className="action-btn-minimal" onClick={() => setViewDay(d)}><Icons.Edit/></button><button className="action-btn-minimal" style={{color:'var(--danger)'}} onClick={() => deleteDay(d)}><Icons.Trash/></button></div>
                        </div>
                    ))}
                    <div style={{marginTop:'20px', display:'flex', gap:'10px'}}><input placeholder="New Day Name" value={newDay} onChange={e => setNewDay(e.target.value)} /><button className="btn btn-success" style={{width:'auto'}} onClick={addDay}>Add</button></div></div>
                    
                    <div className="card"><h3>Data</h3><div style={{display:'flex', gap:'10px'}}><button className="btn btn-secondary" onClick={() => fileInput.current.click()}><Icons.Export/> Restore</button><input type="file" ref={fileInput} style={{display:'none'}} onChange={handleImport} /><button className="btn btn-danger" onClick={() => { if(confirm("Reset?")) { localStorage.removeItem('customWorkouts'); window.location.reload(); }}}>Reset Defaults</button></div></div>
                </div>
            );
        }

        function Workout({ selectedDay, setSelectedDay, customWorkouts, workoutLog, setWorkoutLog, personalRecords, setPersonalRecords }) {
            const [sets, setSets] = useState([]);
            const [rest, setRest] = useState(0);
            const [plateCalc, setPlateCalc] = useState('');
            const [expandedEx, setExpandedEx] = useState({});
            const [editMode, setEditMode] = useState(false);
            const [sessionStart] = useState(Date.now());
            const [elapsed, setElapsed] = useState(0);
            const [paused, setPaused] = useState(false);

            const getHistory = (exName, setIndex) => {
                const dates = Object.keys(workoutLog).sort().reverse();
                for (let d of dates) {
                    const ex = workoutLog[d].exercises?.find(e => e.name === exName);
                    if (ex && ex.logs[setIndex] && ex.logs[setIndex].weight) return ex.logs[setIndex];
                }
                return null;
            };

            const autoFill = (exIndex, setIndex) => {
                const newSets = [...sets];
                const hist = getHistory(sets[exIndex].name, setIndex);
                if (hist && !newSets[exIndex].logs[setIndex].weight) {
                    newSets[exIndex].logs[setIndex].weight = hist.weight;
                    newSets[exIndex].logs[setIndex].reps = hist.reps;
                } else if (setIndex > 0) {
                    newSets[exIndex].logs[setIndex].weight = newSets[exIndex].logs[setIndex-1].weight;
                    newSets[exIndex].logs[setIndex].reps = newSets[exIndex].logs[setIndex-1].reps;
                }
                setSets(newSets);
            };

            const calcWarmup = (weight) => {
                const w = parseFloat(weight);
                if(!w) return alert("Enter weight first");
                alert(`Warmup for ${w}lbs:\n\nBar x 10\n${Math.round(w*0.5/5)*5} x 5\n${Math.round(w*0.7/5)*5} x 3\n${Math.round(w*0.9/5)*5} x 1`);
            }

            const addQuickExercise = () => {
                const name = prompt('Exercise Name:');
                if(!name) return;
                const newSets = [...sets, { name, logs: Array(3).fill().map(() => ({ reps: '', weight: '' })) }];
                setSets(newSets);
            };

            const addSet = (exIdx) => {
                const newSets = [...sets];
                newSets[exIdx].logs.push({ reps: '', weight: '', note: '' });
                setSets(newSets);
            };

            const removeSet = (exIdx, setIdx) => {
                const newSets = [...sets];
                newSets[exIdx].logs.splice(setIdx, 1);
                setSets(newSets);
            };

            useEffect(() => {
                if (selectedDay && customWorkouts[selectedDay]) {
                    setSets(customWorkouts[selectedDay].exercises.map(ex => ({
                        name: ex.name,
                        logs: Array(ex.sets || 3).fill().map(() => ({ reps: '', weight: '', note: '' }))
                    })));
                }
            }, [selectedDay]);

            useEffect(() => {
                const timer = setInterval(() => { if(!paused) setElapsed(Math.floor((Date.now() - sessionStart) / 1000)); }, 1000);
                return () => clearInterval(timer);
            }, [sessionStart, paused]);

            useEffect(() => {
                let timer;
                if (rest > 0) timer = setInterval(() => setRest(r => r - 1), 1000);
                if (rest === 0 && navigator.vibrate) navigator.vibrate([200, 100, 200]);
                return () => clearInterval(timer);
            }, [rest]);

            const finish = () => {
                const date = new Date().toISOString().split('T')[0];
                let tonnage = 0;
                let newPrs = {...personalRecords};
                let hitPr = false;
                sets.forEach(ex => ex.logs.forEach(l => {
                    if(l.weight && l.reps) {
                        tonnage += parseFloat(l.weight) * parseFloat(l.reps);
                        const oneRM = parseFloat(l.weight) * (1 + parseFloat(l.reps)/30);
                        const key = ex.name.toLowerCase().replace(/[^a-z0-9]/g, '-');
                        if(!newPrs[key] || oneRM > newPrs[key]) { newPrs[key] = oneRM; hitPr = true; }
                    }
                }));
                setPersonalRecords(newPrs);
                setWorkoutLog({...workoutLog, [date]: { day: selectedDay, exercises: sets, tonnage, duration: elapsed, completed: true }});
                
                if (hitPr) {
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    alert(`üéâ NEW PR! Volume: ${tonnage.toLocaleString()} lbs`);
                } else {
                    alert(`Saved! Volume: ${tonnage.toLocaleString()} lbs`);
                }
                setSelectedDay(null);
            };

            const calculatePlates = (val) => {
                const w = parseFloat(val); if(!w) return [];
                const side = (w - 45) / 2; if(side <= 0) return [];
                const plates = [45, 25, 10, 5, 2.5]; let rem = side; const res = [];
                plates.forEach(p => { const c = Math.floor(rem/p); if(c>0){ res.push({weight: p, count: c}); rem -= p*c; }});
                return res;
            };

            const formatTime = (s) => {
                const m = Math.floor(s / 60);
                const sec = s % 60;
                return `${m}:${sec < 10 ? '0' : ''}${sec}`;
            };

            const editTime = () => {
                const newMins = prompt("Set Minutes:", Math.floor(elapsed/60));
                if (newMins !== null && !isNaN(newMins)) setElapsed(parseInt(newMins) * 60);
            };

            if (!selectedDay) return (
                <div>
                    {Object.entries(customWorkouts).map(([k, v]) => (
                        <div key={k} className="day-card" onClick={() => setSelectedDay(k)}>
                            <div className="day-name">{k}</div>
                            <div className="day-focus">{v.name}</div>
                        </div>
                    ))}
                </div>
            );

            const plates = calculatePlates(plateCalc);

            return (
                <div>
                    <div className="card">
                        <div style={{display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                            <div>
                                <h2 style={{margin:0, textTransform:'capitalize'}}>{selectedDay}</h2>
                                <div className="session-timer-container">
                                    <div className="session-timer" onClick={() => setPaused(!paused)}>{paused ? '‚è∏' : '‚è±Ô∏è'} {formatTime(elapsed)}</div>
                                    <button className="action-btn-minimal" onClick={editTime}><Icons.Edit/></button>
                                </div>
                            </div>
                            <button className="action-btn-minimal" onClick={() => setEditMode(!editMode)}><Icons.Edit/></button>
                        </div>
                    </div>

                    <div className="card" style={{background:'var(--bg-accent)'}}>
                        <h3>Plate Calculator</h3>
                        <input type="number" inputMode="decimal" placeholder="Total Weight (lbs)" value={plateCalc} onChange={e => setPlateCalc(e.target.value)} />
                        {plateCalc && plates.length > 0 && (
                            <div className="barbell-container">
                                <div className="bar-end"></div>
                                {plates.map((p, i) => Array(p.count).fill().map((_, j) => <div key={i+j} className={`plate plate-${p.weight.toString().replace('.','_')}`}></div>))}
                                <div className="bar-shaft"></div>
                            </div>
                        )}
                        {plateCalc && <p style={{fontSize:'12px', color:'var(--text-secondary)', textAlign:'center', marginTop:'5px'}}>Per Side: {plates.map(p => `${p.weight}x${p.count}`).join(' + ')}</p>}
                    </div>

                    {editMode && <button className="btn btn-secondary" onClick={addQuickExercise}>+ Add Exercise</button>}

                    {sets.map((ex, exIdx) => (
                        <div key={exIdx} className="card">
                            <div style={{display:'flex', justifyContent:'space-between', marginBottom:'10px'}}>
                                <div style={{display:'flex', alignItems:'center', gap:'8px'}}>
                                    <h3 style={{margin:0}}>{ex.name}</h3>
                                    <button className="action-btn-minimal" style={{color: 'orange'}} onClick={() => calcWarmup(ex.logs[0].weight)}><Icons.Warmup/></button>
                                </div>
                                <button className="action-btn-minimal" onClick={() => setExpandedEx({...expandedEx, [exIdx]: !expandedEx[exIdx]})} >?</button>
                            </div>
                            {expandedEx[exIdx] && customWorkouts[selectedDay].exercises[exIdx] && <p style={{fontSize:'13px', color:'var(--text-secondary)', marginBottom:'15px'}}>{customWorkouts[selectedDay].exercises[exIdx].description}</p>}
                            
                            {ex.logs.map((set, sIdx) => {
                                const hist = getHistory(ex.name, sIdx);
                                return (
                                    <div key={sIdx}>
                                        {hist && <div className="last-workout" style={{fontSize:'11px', color:'var(--text-tertiary)', marginLeft:'50px', marginBottom:'4px'}}>Last: {hist.weight}x{hist.reps}</div>}
                                        <div className="set-row">
                                            <div className="set-label">{sIdx + 1}</div>
                                            <input type="number" inputMode="decimal" placeholder="Reps" className="set-input" value={set.reps} onChange={e => {
                                                const n = [...sets]; n[exIdx].logs[sIdx].reps = e.target.value; setSets(n);
                                            }} onBlur={() => setRest(90)} />
                                            <input type="number" inputMode="decimal" placeholder="Lbs" className="set-input" value={set.weight} onChange={e => {
                                                const n = [...sets]; n[exIdx].logs[sIdx].weight = e.target.value; setSets(n);
                                            }} />
                                            <button className="autofill-btn" onClick={() => autoFill(exIdx, sIdx)}><Icons.Magic/></button>
                                            <button className="action-btn-minimal" style={{color:'var(--danger)', marginLeft:'5px'}} onClick={() => removeSet(exIdx, sIdx)}><Icons.Close/></button>
                                        </div>
                                    </div>
                                );
                            })}
                            <button className="add-set-btn" onClick={() => addSet(exIdx)}>+ Add Set</button>
                        </div>
                    ))}
                    <button className="btn btn-success" onClick={finish}>Complete Workout</button>
                    {rest > 0 && (
                        <div className="timer-display">
                            <div>{rest}s</div>
                            <div className="timer-controls">
                                <span className="timer-mod" onClick={() => setRest(rest - 10)}>-10</span>
                                <span className="timer-mod" onClick={() => setRest(rest + 30)}>+30</span>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function Stats({ workoutLog, personalRecords }) { 
            return (
                <div>
                    <div className="stat-grid"><div className="stat-card"><div className="stat-val">{Object.keys(personalRecords).length}</div><div className="stat-lbl">PRs</div></div></div>
                    <div className="card"><h3>Personal Records</h3>
                        {Object.entries(personalRecords).map(([k,v]) => <div key={k} style={{borderBottom:'1px solid #eee', padding:'8px 0', display:'flex', justifyContent:'space-between'}}><span>{k}</span><b>{Math.round(v)} lbs</b></div>)}
                    </div>
                </div>
            ); 
        }
        
        function History({ workoutLog, customWorkouts, deleteWorkout }) {
            return (
                <div>
                    {Object.entries(workoutLog).reverse().map(([date, data]) => (
                        <div key={date} className="card">
                            <div className="history-header"><div><h4 style={{margin:0}}>{new Date(date).toLocaleDateString()}</h4><p style={{fontWeight:'bold'}}>{data.day}</p></div><button className="action-btn-minimal" style={{color:'var(--danger)'}} onClick={() => deleteWorkout(date)}><Icons.Trash /></button></div>
                            {data.duration && <p style={{fontSize:'12px', color:'var(--text-secondary)'}}>‚è±Ô∏è Duration: {Math.floor(data.duration/60)}m {data.duration%60}s</p>}
                            {data.exercises && data.exercises.map((ex, i) => {
                                const setsSummary = ex.logs.filter(l => l.weight && l.reps).map(l => `${l.weight}x${l.reps}`).join(', ');
                                if (!setsSummary) return null;
                                return <div key={i} className="history-exercise"><strong>{ex.name}</strong><div className="history-sets">{setsSummary}</div></div>;
                            })}
                        </div>
                    ))}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
